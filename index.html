<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Forensics Quiz Scoreboard 2025</title>
    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        display: ["Inter", "ui-sans-serif", "system-ui", "-apple-system", "Segoe UI", "Roboto", "Helvetica Neue", "Arial"],
                    },
                },
            },
        };
    </script>
    <!-- Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script defer src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        ::-webkit-scrollbar { height: 10px; width: 10px; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 9999px; }
        .score-input::-webkit-outer-spin-button,.score-input::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0 }
        .score-input[type=number]{ -moz-appearance:textfield; appearance: textfield; }
        .cell-focus { box-shadow: inset 0 0 0 2px rgb(59 130 246 / .6); border-radius: .5rem; }
        @media print {
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 text-slate-800 min-h-screen font-display">
    <div class="max-w-7xl mx-auto p-4 md:p-8">
        <!-- Header / Branding -->
        <div class="flex flex-col items-center gap-4 mb-6 text-center">
            <div class="w-16 h-16 bg-white rounded-2xl shadow-md ring-1 ring-slate-200 flex items-center justify-center overflow-hidden">
                <!-- 🔁 PLACEHOLDER: Replace the src below with your logo / image URL -->
                <img id="logoImg" src="" alt="Logo placeholder" class="w-full h-full object-cover hidden"/>
                <span id="logoPlaceholder" class="text-slate-400 text-xs p-2 text-center">Logo<br/>Placeholder</span>
            </div>
            <div class="flex-1">
                <h1 id="mainTitle" class="text-3xl md:text-4xl font-bold tracking-tight px-2 py-1 rounded-lg hover:bg-slate-200/60 focus:outline-none">Forensics Quiz Scoreboard 2025</h1>
            </div>
            <div class="no-print">
                <label class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-white ring-1 ring-slate-200 shadow-sm cursor-pointer hover:bg-slate-50">
                    <i class="ph ph-image"></i>
                    <span>Set Logo</span>
                    <input type="file" id="logoFile" accept="image/*" class="hidden"/>
                </label>
            </div>
        </div>

        <!-- Table wrapper -->
        <div class="overflow-auto rounded-2xl ring-1 ring-slate-200 bg-white shadow">
            <table id="scoreTable" class="min-w-full border-separate border-spacing-0">
                <thead class="bg-slate-50 text-slate-600">
                    <tr>
                        <th class="sticky left-0 z-10 bg-slate-50 px-4 py-3 text-left font-semibold border-b border-slate-200">Team</th>
                        <!-- Dynamic Round Headers here -->
                        <th id="roundHeadersEnd" class="px-4 py-3 text-left font-semibold border-b border-slate-200">Total</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <!-- Toolbar -->
        <div class="no-print grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2 mt-6">
            <button type="button" id="addTeamBtn" class="px-3 py-2 rounded-xl bg-indigo-600 text-white font-semibold shadow hover:bg-indigo-500">+ Team</button>
            <button type="button" id="addRoundBtn" class="px-3 py-2 rounded-xl bg-indigo-600 text-white font-semibold shadow hover:bg-indigo-500">+ Round</button>

            <button type="button" id="resetScoresBtn" class="px-3 py-2 rounded-xl bg-white ring-1 ring-slate-200 shadow hover:bg-slate-50">Reset Scores</button>
            <button type="button" id="clearAllBtn" class="px-3 py-2 rounded-xl bg-white ring-1 ring-slate-200 shadow hover:bg-slate-50">Clear All</button>

            <button type="button" id="exportCsvBtn" class="px-3 py-2 rounded-xl bg-white ring-1 ring-slate-200 shadow hover:bg-slate-50">Export CSV</button>
            <button type="button" id="printBtn" class="px-3 py-2 rounded-xl bg-white ring-1 ring-slate-200 shadow hover:bg-slate-50">Print</button>
        </div>
    </div>

    <script>
        // --- Persistent state ---
        const LS_KEY = 'scoreboard.v1';
        const DEFAULT_TITLE = 'Forensics Quiz Scoreboard 2025';

        const state = {
            title: DEFAULT_TITLE,
            rounds: 3,
            teams: [
                { id: crypto.randomUUID(), name: 'Team A', scores: [] },
                { id: crypto.randomUUID(), name: 'Team B', scores: [] },
            ],
            logo: null,
        };

        function loadState() {
            try {
                const raw = localStorage.getItem(LS_KEY);
                if (!raw) return;
                const parsed = JSON.parse(raw);
                if (parsed && typeof parsed === 'object') {
                    Object.assign(state, parsed);
                }
            } catch (e) { console.warn('Failed to load state:', e); }
        }

        function saveState() {
            try {
                localStorage.setItem(LS_KEY, JSON.stringify(state));
            } catch (e) { console.warn('Failed to save state:', e); }
        }

        // --- UI rendering ---
        const tableBody = document.getElementById('tableBody');
        const roundHeadersEnd = document.getElementById('roundHeadersEnd');
        const mainTitle = document.getElementById('mainTitle');

        function renderTitle() {
            mainTitle.textContent = state.title;
            document.title = state.title;
        }

        function renderRoundHeaders() {
            // Remove existing dynamic round headers
            const theadRow = roundHeadersEnd.parentElement;
            [...theadRow.querySelectorAll('[data-round-header]')].forEach(el => el.remove());
            // Insert new round headers before Total
            for (let r = 0; r < state.rounds; r++) {
                const th = document.createElement('th');
                th.className = 'px-4 py-3 text-left font-semibold border-b border-slate-200';
                th.dataset.roundHeader = '1';
                th.innerHTML = `Round <span class="text-slate-400">${r + 1}</span>`;
                theadRow.insertBefore(th, roundHeadersEnd);
            }
        }

        function ensureScoresLength(team) {
            if (!Array.isArray(team.scores)) team.scores = [];
            while (team.scores.length < state.rounds) team.scores.push(0);
            if (team.scores.length > state.rounds) team.scores.length = state.rounds;
        }

        function teamTotal(team) {
            return team.scores.reduce((a, b) => a + (Number(b) || 0), 0);
        }

        function renderTableRows() {
            tableBody.innerHTML = '';
            state.teams.forEach((team, rowIdx) => {
                ensureScoresLength(team);
                const tr = document.createElement('tr');

                // Team Name (sticky)
                const nameTd = document.createElement('td');
                nameTd.className = 'sticky left-0 z-10 bg-white/95 backdrop-blur px-4 py-2 border-b border-slate-100 whitespace-nowrap';
                nameTd.style.minWidth = '12rem';
                nameTd.appendChild(renderTeamNameCell(team));
                tr.appendChild(nameTd);

                // Round score inputs
                for (let c = 0; c < state.rounds; c++) {
                    tr.appendChild(renderScoreCell(team, c));
                }

                // Total cell
                const totalTd = document.createElement('td');
                totalTd.className = 'px-4 py-2 border-b border-slate-100 font-semibold text-right';
                totalTd.textContent = teamTotal(team);
                totalTd.dataset.totalFor = team.id;
                tr.appendChild(totalTd);

                tableBody.appendChild(tr);
            });
        }

        function renderTeamNameCell(team) {
            const wrap = document.createElement('div');
            wrap.className = 'flex items-center gap-2';

            const nameDiv = document.createElement('div');
            nameDiv.className = 'px-2 py-1 rounded-lg hover:bg-slate-50 focus:outline-none';
            nameDiv.contentEditable = 'true';
            nameDiv.spellcheck = false;
            nameDiv.textContent = team.name;
            nameDiv.addEventListener('focus', () => nameDiv.classList.add('cell-focus'));
            nameDiv.addEventListener('blur', () => {
                nameDiv.classList.remove('cell-focus');
                const txt = nameDiv.textContent.trim();
                team.name = txt || team.name;
                saveState();
            });
            nameDiv.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') { e.preventDefault(); nameDiv.blur(); }
            });

            const delBtn = document.createElement('button');
            delBtn.className = 'no-print ml-1 p-1 rounded-lg text-slate-400 hover:text-red-600 hover:bg-red-50';
            delBtn.innerHTML = '<i class="ph ph-trash"></i>';
            delBtn.title = 'Remove team';
            delBtn.addEventListener('click', () => {
                if (confirm(`Remove team \"${team.name}\"?`)) {
                    state.teams = state.teams.filter(t => t.id !== team.id);
                    saveState();
                    render();
                }
            });

            wrap.appendChild(nameDiv);
            wrap.appendChild(delBtn);
            return wrap;
        }

        function renderScoreCell(team, roundIdx) {
            const td = document.createElement('td');
            td.className = 'px-2 py-1 border-b border-slate-100';
            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'score-input w-24 md:w-28 lg:w-32 text-right px-3 py-2 rounded-xl bg-slate-50 focus:bg-white ring-1 ring-transparent focus:ring-indigo-200 transition';
            input.value = team.scores[roundIdx] ?? 0;
            input.inputMode = 'numeric';
            input.min = '0';
            input.addEventListener('input', () => {
                team.scores[roundIdx] = Number(input.value || 0);
                updateTeamTotal(team);
                saveState();
            });
            td.appendChild(input);
            return td;
        }

        function updateTeamTotal(team) {
            const totalCell = document.querySelector(`[data-total-for="${team.id}"]`);
            if (totalCell) totalCell.textContent = teamTotal(team);
        }

        function render() {
            renderTitle();
            renderRoundHeaders();
            renderTableRows();
        }

        // --- Actions ---
        document.getElementById('addTeamBtn').addEventListener('click', () => {
            state.teams.push({ id: crypto.randomUUID(), name: `Team ${String.fromCharCode(65 + state.teams.length)}`, scores: Array(state.rounds).fill(0) });
            saveState();
            render();
        });

        document.getElementById('addRoundBtn').addEventListener('click', () => {
            state.rounds += 1;
            state.teams.forEach(t => t.scores.push(0));
            saveState();
            render();
        });

        document.getElementById('resetScoresBtn').addEventListener('click', () => {
            if (!confirm('Reset all scores to 0?')) return;
            state.teams.forEach(t => t.scores = Array(state.rounds).fill(0));
            saveState();
            render();
        });

        document.getElementById('clearAllBtn').addEventListener('click', () => {
            if (!confirm('Clear teams, rounds, and scores?')) return;
            Object.assign(state, { title: DEFAULT_TITLE, rounds: 3, teams: [ { id: crypto.randomUUID(), name: 'Team A', scores: [] }, { id: crypto.randomUUID(), name: 'Team B', scores: [] } ] });
            saveState();
            render();
        });

        document.getElementById('printBtn').addEventListener('click', () => window.print());

        // Export CSV
        document.getElementById('exportCsvBtn').addEventListener('click', () => {
            const headers = ['Team', ...Array.from({length: state.rounds}, (_, i) => `Round ${i+1}`), 'Total'];
            const rows = state.teams.map(t => [t.name, ...t.scores.map(n => Number(n)||0), teamTotal(t)]);
            const csv = [headers, ...rows].map(r => r.map(v => typeof v === 'string' && v.includes(',') ? '"'+v.replaceAll('"','""')+'"' : v).join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'scoreboard.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Logo handling
        const logoFile = document.getElementById('logoFile');
        const logoImg = document.getElementById('logoImg');
        const logoPlaceholder = document.getElementById('logoPlaceholder');

        function applyLogo() {
            if (state.logo) {
                logoImg.src = state.logo;
                logoImg.classList.remove('hidden');
                logoPlaceholder.classList.add('hidden');
            } else {
                logoImg.src = '';
                logoImg.classList.add('hidden');
                logoPlaceholder.classList.remove('hidden');
            }
        }

        logoFile.addEventListener('change', (e) => {
            const file = e.target.files?.[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = () => {
                state.logo = reader.result;
                saveState();
                applyLogo();
            };
            reader.readAsDataURL(file);
        });

        // Title editing
        mainTitle.contentEditable = 'true';
        mainTitle.spellcheck = false;
        mainTitle.addEventListener('focus', () => mainTitle.classList.add('cell-focus'));
        mainTitle.addEventListener('blur', () => {
            mainTitle.classList.remove('cell-focus');
            const txt = mainTitle.textContent.trim();
            state.title = txt || state.title;
            renderTitle();
            saveState();
        });
        mainTitle.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') { e.preventDefault(); mainTitle.blur(); }
        });

        // Keyboard save shortcut
        window.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
                e.preventDefault();
                saveState();
                const btn = document.getElementById('exportCsvBtn');
                btn.classList.add('ring-2','ring-emerald-300');
                setTimeout(() => btn.classList.remove('ring-2','ring-emerald-300'), 400);
            }
        });

        // Init
        loadState();
        render();
        applyLogo();
    </script>
</body>
</html>